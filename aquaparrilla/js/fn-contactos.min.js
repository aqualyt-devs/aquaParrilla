$(()=>{const o=Cookies.get("AquaToken"),e=Cookies.get("AquaTokenID"),t=[];let a=null;const i=$("#idPS").val(),n=$("#idContactoTemporal").val();let c=$("#selectContactoTemporal"),l=$(".selectContacto"),s=$("#compararContactos"),r=$(".unirContactos"),d=$("#unirPersonaContacto"),p=$("#updateContacto"),u=$("#saveContacto"),f=$("#deleteContacto"),m=$("#comparativaContactos"),C=$("#infoContacto"),h=$("#desvincularContactos"),_=$("#copiarDireccion"),g=$(".unir"),v=$(".unchecked"),k=$(".avisoUnchecked");var z="http://api.aqualyt.net:5002";$("select").material_select(),k.hide(),s.hide(),$.ajaxSetup({cache:!1,headers:{token:o,"Content-Type":"application/json"}}),c.on("click",()=>M(c,1)),l.on("click",function(){M($(this),2)}),r.on("click",function(){F(m,$(this).attr("idPersona1"),$(this).attr("idPersona2"))}),d.on("click",function(){H(m,$(this).attr("idPersona"),$(this).attr("idContacto"))}),g.on("click",()=>U()),h.on("click",()=>A(m)),p.on("click",function(){y($(this).attr("idContacto"))}),u.on("click",function(){N($(this).attr("idContacto"))}),_.on("click",function(){O()}),f.on("click",function(){J($(this).attr("idContacto"))});const M=function(o,e){1===e?b(o):P(o),w()},b=function(o){let e=o.attr("idContacto");a==e?(a=null,S(o)):(a=e,q(o))},P=function(o){let e=o.attr("idContacto"),a=$.inArray(e,t);-1!==a?(t.splice(a,1),S(o)):(t.push(e),q(o))},q=function(o){o.find("i").html("check_box"),o.addClass("green-text text-darken-2")},S=function(o){o.find("i").html("check_box_outline_blank"),o.removeClass("green-text text-darken-2")},w=function(){let o=t.length;null!==a&&1==o||2==o?j():T()},j=function(){l.addClass("disabled"),t.map(o=>$("a[idContacto='"+o+"']").removeClass("disabled")),null===a&&c.addClass("disabled"),x()},T=function(){s.hide(),l.removeClass("disabled"),c.removeClass("disabled")},x=function(){let o=t.join();s.attr("href",`contactoComparar.php?idPS=${i}&idCT=${n}&idContacto=${a}&idPersona=${o}`),s.show()},y=function(o){let e=Q(C),t=z+"/equipos/contactos/edit/temporal/"+o;B(t,e).then(o=>{100==o.codigo&&Materialize.toast("Datos de contacto actualizados",4e3)})},N=function(o){let t=Q(C),a=z+"/equipos/contactos/edit/temporal/"+o;B(a,t).then(t=>{100==t.codigo?$.post(z+"/equipos/crear_persona_from_temporal/"+o+"/"+e,{},function(o){200==o.codigo?Materialize.toast(o.detalles,4e3):100==o.codigo&&Materialize.toast("Contacto guardado en el sistema correctamente",2e3,"",function(){window.open("./contactoControl.php?idPS="+i,"_self")})},"json"):Materialize.toast(t.detalles,4e3)})},O=function(){console.log("HOLA"),jQuery.getJSON(z+"/equipos/direccion/ps/"+i,function(o){let e=o.contenido[1];$("#calle").val(e.calle),$("#numero_calle").val(e.num_calle),$("#piso").val(e.piso),$("#cp").val(e.cp),$("#poblacion").val(e.poblacion),$("#provincia").val(e.provincia),$("#tipo_calle").val(e.tipo_calle),$("#tipo_calle").material_select(),Materialize.updateTextFields()})},A=function(o){let e=$("#relacion").val(),t=$("#idContacto1").val(),a=$("#idContacto2").val();"1"===e?D(t,a):I(t,a)},J=function(o){$.post(z+"/equipos/contactos/temporal/delete/"+o,{},function(o){200==o.codigo?Materialize.toast(o.detalles,4e3):100==o.codigo&&Materialize.toast("Contacto eliminado",2e3,"",function(){window.open("./contactoControl.php?idPS="+i,"_self")})},"json")},D=function(o,t){$.post(z+"/equipos/desmarcar_coincidencia_persona_temporal/persona/"+t+"/temporal/"+o+"/idUsuario/"+e,{},function(e){200==e.codigo?Materialize.toast(e.detalles,4e3):100==e.codigo&&Materialize.toast("Contactos desenlazados correctamente",2e3,"",function(){window.open("./contactoComprobar.php?idPS="+i+"&idContacto="+o,"_self")})},"json")},I=function(o,t){console.log("url"),console.log(z+"/equipos/desmarcar_coincidencia_persona/persona1/"+o+"/persona2/"+t+"/idUsuario/"+e),$.post(z+"/equipos/desmarcar_coincidencia_persona/persona1/"+o+"/persona2/"+t+"/idUsuario/"+e,{},function(o){200==o.codigo?Materialize.toast(o.detalles,4e3):100==o.codigo&&Materialize.toast("Contactos desenlazados correctamente",2e3,"",function(){window.open("./contactoControl.php?idPS="+i,"_self")})},"json")},U=function(){let o={},e=!1;v.empty(),$(":input:radio").each(function(){o[this.name]=!0});for(let t in o){let o=!!$(":radio[name='"+t+"']:checked").length;o||(e=!0,v.append("<li>"+E(t)+"</li>"))}e?k.show():k.hide()},F=function(o,t,a){let i=z+"/equipos/update_persona",n=JSON.parse(Q(o));n.id=t,n.modificado_por=e;let c=JSON.stringify(n);B(i,c).then(o=>{if(console.log(o),200==o.codigo)Materialize.toast(o.detalles,4e3);else if(100==o.codigo){let o=z+"/equipos/traspasar_registros_persona/"+t+"/"+a;B(o).then(o=>{200==o.codigo?(Materialize.toast(o.detalles,4e3),reject(!0)):100==o.codigo&&L(a)})}})},H=function(o,t,a){let n=JSON.parse(Q(o)),c=z+"/equipos/update_persona";n.id=t,n.modificado_por=e;let l=JSON.stringify(n);B(c,l).then(o=>{if(200==o.codigo)Materialize.toast(o.detalles,4e3),reject(!0);else if(100==o.codigo){let o=z+"/equipos/traspasar_registros_persona_from_temporal/"+t+"/"+a;B(o).then(o=>{200==o.codigo?(Materialize.toast(o.detalles,4e3),reject(!0)):100==o.codigo&&Materialize.toast("Información del contacto transferida correctamente",2e3,"",function(){window.open("contactoControl.php?idPS="+i,"_self")})})}})},L=function(o){let e=z+"/equipos/contactos/persona/delete/"+o;$.post(e,{},function(o){200==o.codigo?Materialize.toast(o.detalles,4e3):100==o.codigo&&Materialize.toast("Información de persona transferida correctamente",2e3,"",function(){window.open("contactoComprobar.php?idPS="+i+"&idContacto="+n,"_self")})},"json")},Q=function(o){let e=o.serializeArray(),t={};return $.map(e,function(o,e){t[o.name]=o.value}),JSON.stringify(t)},B=function(o,e){return $.ajax({url:o,type:"PUT",data:e})},E=function(o){let e=["id","nombre","apellido1","apellido2","telef1","telef2","movil","email","tipo_calle","calle","numero_calle","piso","cp","observaciones","dni","poblacion","provincia","nombreCreador","fecha_modificado","creado_por"],t=["ID","Nombre","Apellido 1","Apellido 2","Teléfono 1","Teléfono 2","Móvil","email","Tipo calle","Calle","Número","Piso","CP","Observaciones","DNI","Población","Provincia","Creador","Fecha Modificado","creado_por"],a=e.indexOf(o);return-1!=a?t[a]:o}});