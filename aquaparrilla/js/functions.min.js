function loadEquiposList(){jQuery.getJSON(URLAPI+"/equipos/equipo/listado/detallado",function(a){100==a.codigo&&($.each(a.contenido,function(a,e){$("#equiposSelect").append('<option value="'+e.id+'">'+e.nombre+"</option>"),$("#equiposSelectCambio").append('<option value="'+e.id+'">'+e.nombre+"</option>")}),$("#equiposSelect").material_select(),$("#equiposSelectCambio").material_select())})}function contadorPS(a){jQuery.getJSON(URLAPI+"/equipos/contar_servicios?date="+fecha+a,function(a){100==a.codigo&&$.each(a.contenido[1],function(a,e){switch(a){case"llamar":$(".bagde4").html(e);break;case"pendientes":$(".bagde8").html(e);break;case"anulados":$(".bagde3").html(e);break;case"no_realizados":$(".bagde6").html(e);break;case"tramite":$(".bagde1").html(e);break;case"en_servei":$(".bagde5").html(e);break;case"en_espera":$(".bagde2").html(e);break;case"realizados":$(".bagde7").html(e)}})})}function initAutocomplete(){autocomplete=new google.maps.places.Autocomplete(document.getElementById("autocomplete"),{types:["geocode"]}),autocomplete.addListener("place_changed",fillInAddress)}function fillInAddress(){var a=autocomplete.getPlace();$("#lugarLat").val(a.geometry.location.lat()),$("#lugarLong").val(a.geometry.location.lng()),createMapPSLocation(a.formatted_address)}function createMapPSLocation(a,e){psLocationMapLoaded&&$("#PSMapLocation").gmap3({clear:{name:["marker","directionsrenderer","trafficlayer"]}}),$("#PSMapLocation").gmap3({getlatlng:{address:a,callback:function(a){a&&$(this).gmap3({map:{options:{center:a[0].geometry.location,zoom:15}},marker:{latLng:a[0].geometry.location}})}}}),psLocationMapLoaded=!0}function getArrayItembyValue(a,e){return $.grep(a,function(a){return a.id==e})}function compareTiempos(a,e){return a.horaEstimada<e.horaEstimada?-1:a.horaEstimada>e.horaEstimada?1:0}function column_sizer(){var a=$(window).height()-110;$(".columnHeight").css("height",a)}function aplicarFiltro(){var a="";$("#listaFiltros").empty();var e=$("input[name=tipo_ps]:checked","#filtros").val(),o=$("input[name=estado]:checked","#filtros").val(),i=$("input[name=naturaleza]:checked","#filtros").val(),t=$("input[name=urgencia]:checked","#filtros").val(),n=$("input[name=ordenacion]:checked","#filtros").val();if($(".itemPS").hide(),$('[tipoPS="'+e+'"]').show(),$('[urgencia="'+t+'"]').show(),$('[naturaleza="'+i+'"]').show(),$('[estado="'+o+'"]').show(),$('[ordenacion="'+n+'"]').show(),null!=e){var l=getArrayItembyValue(listTiposPS,e);$("#listaFiltros").append("<li>Tipo PS: "+l[0].tipo+"</li>"),a+="&tipo="+e}if(null!=o){var c=getArrayItembyValue(listEstados,o);$("#listaFiltros").append("<li>Estado: "+c[0].ESTADO+"</li>"),a+="&estado="+o}if(null!=i){var r=getArrayItembyValue(listNaturalezas,i);$("#listaFiltros").append("<li>Naturaleza: "+r[0].naturaleza+"</li>"),a+="&naturaleza="+i}if(null!=t){var s=getArrayItembyValue(listUrgencias,t);$("#listaFiltros").append("<li>Urgencia: "+s[0].urgencia+"</li>"),a+="&urgencia="+t}null!=n&&(a+=2==n?"&order=id-ASC":"&order=hora_programat-ASC"),contadorPS(a),loadPSList(URLAPI+"/equipos/pss/filtrar?fecha1="+fecha+a)}function countPSList(){jQuery.getJSON(URLAPI+"/equipos/pss/filtrar?fecha1="+fecha,function(a){$.each(a.contenido,function(a,e){PSActuales++})})}function loadPSList(a){var e;null==a?(e=URLAPI+"/equipos/pss/filtrar?fecha1="+fecha,$(".itemPSFilter").hide()):(e=a.indexOf("/equipos/pss/filtrar")>=0?a:URLAPI+"/equipos/pss/filtrar?"+a,$(".itemPSFilter").show()),$(".itemPS").remove(),jQuery.getJSON(e,function(a){if(100==a.codigo){direccionesPS=[];var e,o,i,t,n,l,c,r,s,d,p,u,m=0;$.each(a.contenido,function(a,g){switch(e="",m++,i="",t="",u=0,n="",o="",d="",g.naturaleza_id){case"1":l="green",c="http://maps.google.com/mapfiles/marker_green.png";break;case"2":l="blue",c="http://maps.google.com/mapfiles/ms/micons/blue-dot.png";break;case"3":l="orange",c="http://maps.google.com/mapfiles/marker_orange.png";break;case"4":l="red",c="http://maps.google.com/mapfiles/ms/micons/red-dot.png";break;default:l="grey",c="http://maps.google.com/mapfiles/marker_grey.png"}if(p=moment.duration(moment(g.hora_programat_a,"HH:mm").diff(moment())).asMinutes(),1==g.tipo_id&&8==g.estado_id&&(p<=30&&(i="urgencia1"),p<=15&&(i="urgencia2")),null!=g.agrupacion){var h=[];for(var a in g.agrupacion)if(g.agrupacion.hasOwnProperty(a)){var S=g.agrupacion[a].idPS;S!=g.id&&h.push(S)}t="agrupacion",u=1,n='<div class="expandButton" idPSPack="'+h.join()+'"><div class="expandPack center-align"><i class="small material-icons">expand_more</i></div><div class="unexpandPack center-align hide" idPSPack="'+h.join()+'"><i class="small material-icons">expand_less</i></div></div>'}else g.agrupada&&(t="agrupada hide",u=0);null!=g.direccion_gps&&"None"!=g.direccion_gps?(r="place",s="white-text",direccionesPS.push(JSON.parse('{"latLng":['+g.lat+", "+g.lng+'], "id":"'+g.id+'", "address_gps": "'+g.direccion_gps+'", "options": {"icon": "'+c+'"}}'))):(r="gps_off",s="red-text text-accent-4",direccionesPS.push(JSON.parse('{"address": "'+g.direccion+", "+g.cp+", "+g.poblacion+'", "id":"'+g.id+'", "address_gps": "'+g.direccion_gps+'", "options": {"icon": "'+c+'"}}'))),null!=g.equipo_asignado&&""!=g.equipo_asignado&&"None"!=g.equipo_asignado&&(e=" ("+g.equipo_asignado+")"),g.COLA_ACTIVO&&(d='<span class="badge right blue white-text">'+g.COLA_ACTIVO_EQUIPO+"</span>"),$.isEmptyObject(g.REQUISITOS)||$.each(g.REQUISITOS,function(a,e){o+='<span class="new badge purple" data-badge-caption="'+e.valueTipoEquipoMecanico+'"></span>'});var P=function(){for(var a="ÃÀÁÄÂÈÉËÊÌÍÏÎÒÓÖÔÙÚÜÛãàáäâèéëêìíïîòóöôùúüûÑñÇç",e="AAAAAEEEEIIIIOOOOUUUUaaaaaeeeeiiiioooouuuunncc",o={},i=0,t=a.length;i<t;i++)o[a.charAt(i)]=e.charAt(i);return function(a){for(var e=[],i=0,t=a.length;i<t;i++){var n=a.charAt(i);o.hasOwnProperty(a.charAt(i))?e.push(o[n]):e.push(n)}return e.join("")}}(),f="Hora programada: "+moment(g.hora_programat,"HH:mm").format("HH:mm")+" - "+moment(g.hora_programat_a,"HH:mm").format("HH:mm")+"<br />";"0:00:00"!=g.hora_aviso&&(f+="Hora aviso: "+moment(g.hora_aviso,"HH:mm").format("HH:mm")+"<br />"),"0:00:00"!=g.hora_llegada&&(f+="Hora llegada: "+moment(g.hora_llegada,"HH:mm").format("HH:mm")+"<br />"),"00:00:00"!=g.tiempo_teorico&&(f+="Tiempo teórico: "+g.tiempo_teorico+" horas<br />");var b=g.id;null!=g.direccion&&(b+=" "+P(g.direccion.toUpperCase())),null!=g.agente_cobro_nombre&&(b+=" "+P(g.agente_cobro_nombre.toUpperCase())),2==g.urgencia_id?$("#PSList").append('<li class="collection-item itemPS avatar estadoPS'+g.estado_id+" tipoPS"+g.tipo_id+" "+i+" "+t+'" idPS="'+g.id+'" urgencia="'+g.urgencia_id+'" estado="'+g.estado_id+'" naturaleza="'+g.naturaleza_id+'" agrupada="'+u+'" searchTerms="'+b+'"><i class="z-depth-2 material-icons tooltipped circle '+l+" "+s+'" data-tooltip="'+g.problema+'">'+r+'</i><i class="material-icons">priority_high</i><span class="title">PS '+g.id+e+d+"</span><p>"+g.direccion+", "+g.cp+" "+g.poblacion+"<br>"+f+"Agente: "+g.agente_cobro_nombre+"<br />"+o+"</p>"+n+"</li>"):4==g.urgencia_id?$("#PSList").append('<li class="collection-item itemPS avatar estadoPS'+g.estado_id+" tipoPS"+g.tipo_id+" "+i+" "+t+'" idPS="'+g.id+'" urgencia="'+g.urgencia_id+'" estado="'+g.estado_id+'" naturaleza="'+g.naturaleza_id+'" agrupada="'+u+'" searchTerms="'+b+'"><i class="z-depth-2 material-icons tooltipped circle '+l+" "+s+'" data-tooltip="'+g.problema+'">'+r+'</i><i class="material-icons">whatshot</i><span class="title">PS '+g.id+e+d+"</span><p>"+g.direccion+", "+g.cp+" "+g.poblacion+"<br>"+f+"Agente: "+g.agente_cobro_nombre+"<br />"+o+"</p>"+n+"</li>"):6==g.urgencia_id?$("#PSList").append('<li class="collection-item itemPS avatar estadoPS'+g.estado_id+" tipoPS"+g.tipo_id+" "+i+" "+t+'" idPS="'+g.id+'" urgencia="'+g.urgencia_id+'" estado="'+g.estado_id+'" naturaleza="'+g.naturaleza_id+'" agrupada="'+u+'" searchTerms="'+b+'"><i class="z-depth-2 material-icons tooltipped circle '+l+" "+s+'" data-tooltip="'+g.problema+'">'+r+'</i><i class="material-icons">priority_high</i><i class="material-icons">whatshot</i><span class="title">PS '+g.id+e+d+"</span><p>"+g.direccion+", "+g.cp+" "+g.poblacion+"<br>"+f+"Agente: "+g.agente_cobro_nombre+"<br />"+o+"</p>"+n+"</li>"):$("#PSList").append('<li class="collection-item itemPS avatar estadoPS'+g.estado_id+" tipoPS"+g.tipo_id+" "+i+" "+t+'" idPS="'+g.id+'" urgencia="'+g.urgencia_id+'" estado="'+g.estado_id+'" naturaleza="'+g.naturaleza_id+'" agrupada="'+u+'" searchTerms="'+b+'"><i class="z-depth-2 material-icons tooltipped circle '+l+" "+s+'" data-tooltip="'+g.problema+'">'+r+'</i><span class="title">PS '+g.id+e+d+"</span><p>"+g.direccion+", "+g.cp+" "+g.poblacion+"<br>"+f+"Agente: "+g.agente_cobro_nombre+"<br />"+o+"</p>"+n+"</li>"),g.marker=c,g.color=l,listPS.push(g)}),$(".tooltipped").tooltip({delay:50,position:"top",html:!0}),$(".countPS").html(m),controlEquipos||createMapDirecciones(direccionesPS),$("#PSList").optiscroll({autoUpdate:!0})}else $(".countPS").html(""),$("#PSList").append('<li class="collection-item itemPS avatar"><i class="z-depth-2 material-icons circle red">warning</i><span class="title">'+a.detalles+"</span></li>"),$("#PSList").optiscroll()})}function loadEquiposListParrilla(){jQuery.getJSON(URLAPI+"/equipos/cola_ps/equipos",function(a){var e,o,i;100==a.codigo?($.each(a.contenido,function(a,t){switch("None"!=t.EQUIPO.lat&&"None"!=t.EQUIPO.direccion_gps||(t.EQUIPO.lat=41.441523,t.EQUIPO.lng=2.203042,t.EQUIPO.direccion_gps="Carrer de Caracas 13, 08030, Barcelona"),o="000000",t.EQUIPO.IDEstado){case"10":e="4CAF50",i="http://maps.google.com/mapfiles/marker_green.png";break;case"2":e="2196f3",i="http://maps.google.com/mapfiles/ms/micons/blue-dot.png";break;case"7":e="FF9800",i="http://maps.google.com/mapfiles/marker_orange.png";break;case"4":e="f44336",i="http://maps.google.com/mapfiles/ms/micons/red-dot.png";break;default:e="9E9E9E",i="http://maps.google.com/mapfiles/marker_grey.png"}"0.0"!=t.EQUIPO.lat&&"None"!=t.EQUIPO.lat?direccionesEquipo.push(JSON.parse('{"latLng":['+t.EQUIPO.lat+", "+t.EQUIPO.lng+'], "id":"'+a+'", "address_gps": "'+t.EQUIPO.direccion_gps+'", "options": {"icon": "http://chart.apis.google.com/chart?chst=d_map_pin_letter&chld='+t.NOMBRE+"|"+e+"|"+o+'"}}')):direccionesEquipo.push(JSON.parse('{"latLng":['+t.EQUIPO.lat+", "+t.EQUIPO.lng+'], "address": "'+t.EQUIPO.direccion_gps+'", "id":"'+a+'", "address_gps": "'+t.EQUIPO.direccion_gps+'", "options": {"icon": "'+i+'"}}')),$("#equiposSelect").append('<option value="'+a+'">'+t.NOMBRE+"</option>"),$("#equiposSelectCambio").append('<option value="'+a+'">'+t.NOMBRE+"</option>")}),$("#equiposSelect").material_select(),$("#equiposSelectCambio").material_select(),createMapDirecciones(direccionesEquipo),$("#loadingEquipos").hide()):$("#loadingEquipos").hide()})}function createMapRutaEquipo(a,e){var o=e[0].direccion+", "+e[0].cp+", "+e[0].poblacion;"None"!=e[0].direccion_gps&&(o=e[0].direccion_gps),teamMapLoaded&&$("#map2").gmap3({clear:{name:["marker","directionsrenderer","trafficlayer"]}}),$("#map2").gmap3({getroute:{options:{origin:a,destination:o,travelMode:google.maps.DirectionsTravelMode.DRIVING},callback:function(a){if(a){var o=a.routes[0].legs[0],i=o.start_location,t=o.end_location;$(this).gmap3({map:{options:{zoom:13,center:[-33.879,151.235]}},directionsrenderer:{options:{directions:a,suppressMarkers:!0}},marker:{values:[{latLng:i,options:{icon:"http://maps.google.com/mapfiles/ms/micons/truck.png"}},{latLng:t,options:{icon:e[0].marker}}]},autofit:{}})}}},getdistance:{options:{origins:a,destinations:o,drivingOptions:{departureTime:new Date},travelMode:google.maps.TravelMode.DRIVING},callback:function(a,e){var o="";if(a)for(var i=0;i<a.rows.length;i++)for(var t=a.rows[i].elements,n=0;n<t.length;n++)switch(t[n].status){case"OK":o+=t[n].distance.text+" ("+t[n].duration_in_traffic.text+")<br />";break;case"NOT_FOUND":o+="The origin and/or destination of this pairing could not be geocoded<br />";break;case"ZERO_RESULTS":o+="No route could be found between the origin and destination.<br />"}else o="error";$("#distancia").html(o)}},trafficlayer:{}}),teamMapLoaded=!0}function createMapDirecciones(a){$("#map").gmap3({clear:{name:["marker","directionsrenderer","trafficlayer"]}}),$("#map").gmap3({map:{options:{center:[46.578498,2.457275],zoom:5}},marker:{values:a,options:{draggable:!1},events:{click:function(a,e,o){var i=o.id;$("li[idps='"+i+"']").click()}}},autofit:{}})}function loadNotas(){jQuery.getJSON(URLAPI+"/equipos/parrilla/notas/get",function(a){100==a.codigo&&$.each(a.contenido,function(a,e){$("#notaParrilla").html(e.nota),$("#mostrarNota").show()})})}function avisoNuevaPS(){var a=URLAPI+"/equipos/pss/contar/filtrar?fecha1="+fecha;jQuery.getJSON(a,function(a){100==a.codigo&&PSActuales!=a.contenido.contador&&(Push.clear(),PSActuales=a.contenido.contador,Push.create("Nueva PS en el sistema",{body:"Nueva PS en el sistema",icon:"/icon.png",requireInteraction:!0,onClick:function(){window.focus(),location.reload(),this.close()}}))})}function avisoRechazosPS(){var a=URLAPI+"/equipos/get_rechazos?fecha1="+fecha;jQuery.getJSON(a,function(a){100==a.codigo&&PSRechazadas!=a.contenido.contador&&(Push.clear(),PSRechazadas=a.contenido.contador,Push.create("Nueva PS rechazada",{body:"Nueva PS rechazada",icon:"/icon.png",requireInteraction:!0,onClick:function(){window.focus(),location.reload(),this.close()}}))})}function avisoEquipoSinPS(){var a=URLAPI+"/equipos/alertas/count?idTipoAlerta=7&date="+fecha;jQuery.getJSON(a,function(a){100==a.codigo&&(EquiposSinPS<a.contenido.count?(Push.clear(),EquiposSinPS=a.contenido.count,Push.create("Equipo sin PS asignada",{body:"Nuevo equipo sin PS asignada",icon:"/icon.png",requireInteraction:!0,onClick:function(){window.focus(),location.reload(),this.close()}}),$(".new.badge.red.header").remove(),EquiposSinPS>0&&$(".controlEquiposMenu").append('<span class="new badge red header" data-badge-caption="">'+EquiposSinPS+"</span>")):(EquiposSinPS=a.contenido.count,$(".new.badge.red.header").remove(),0!=EquiposSinPS&&$(".controlEquiposMenu").append('<span class="new badge red header" data-badge-caption="">'+EquiposSinPS+"</span>")))})}function actualizarEstadoEquipo(){null!=idEquipo?jQuery.getJSON(URLAPI+"/equipos/equipo/"+idEquipo+"/detallado?date="+fecha,function(a){if(100==a.codigo){var e=$.grep(listPS,function(e){return e.id==a.contenido[1].PS_INFO.ps});"0:00:00"!=a.contenido[1].PS_INFO.hora_aviso?$("#avisoPS").html("<br /> Aviso PS recibido: "+a.contenido[1].PS_INFO.hora_aviso):$("#avisoPS").html(""),"0:00:00"!=a.contenido[1].PS_INFO.hora_llegada?$("#llegadaPS").html("<br /> Hora llegada PS: "+a.contenido[1].PS_INFO.hora_llegada):$("#llegadaPS").html(""),""!=a.contenido[1].PS_INFO.tiempo_estimado_trabajo&&"00:00:00"!=a.contenido[1].PS_INFO.tiempo_estimado_trabajo?$("#tiempoTeorico").html("<br /> Tiempo teórico: "+60*a.contenido[1].PS_INFO.tiempo_estimado_trabajo+" minutos"):$("#tiempoTeorico").html(""),"0:00:00"!=a.contenido[1].PS_INFO.hora_finalizacion?$("#finalizacionPS").html("<br /> Hora Finalización PS: "+a.contenido[1].PS_INFO.hora_finalizacion):$("#finalizacionPS").html(""),createMapRutaEquipo(a.contenido[1].UBICACION.direccion,e)}}):($("#avisoPS").html(""),$("#llegadaPS").html(""),$("#tiempoTeorico").html(""),$("#finalizacionPS").html(""))}var PSAsignado,datepicked,datepickedPausa,datepickedNueva,Token,listEquipos=[],listEstados=[],listNaturalezas=[],listUrgencias=[],listTiposPS=[],listPS=[],teamMapLoaded=!1,direccionesPS=[],direccionesEquipo=[],idPS=null,idEquipo=null,attrAgrupada=0,nombreEquipo="",PSActuales=0,PSRechazadas=0,EquiposSinPS=0,controlEquipos=!1,URLAPI="http://api.aqualyt.net:5002",fileURL=$(location).attr("pathname").split("/").pop();"controlEquipos.php"==fileURL&&(controlEquipos=!0);var fecha=moment().format("DD[/]MM[/]YYYY");-1!=window.location.href.indexOf("?fecha=")&&(fecha=window.location.href.substr(window.location.href.indexOf("?fecha=")+7,10));var datetime=moment(fecha,"DD[/]MM[/]YYYY").format("YYYY-MM-DD HH:mm:ss");$("#selectorFecha").attr("data-value",fecha),$(function(){function a(a){PSAsignado=0,jQuery.getJSON(URLAPI+"/equipos/ps/"+a.id+"/estado",function(o){var i=o.contenido[1].equipo_id,t=o.contenido[1].equipo_id_cola;jQuery.getJSON(URLAPI+"/equipos/equipo/listado/detallado?date="+fecha,function(o){if(listEquipos=[],100==o.codigo){var n,l,c,r="http://maps.google.com/mapfiles/ms/micons/truck.png";$.each(o.contenido,function(e,o){if(!$.isEmptyObject(o.PERSONAL)&&(o.id==i||o.id==t||"None"==i&&"None"==t)){if(c=null,("None"==o.UBICACION.lat||$.isEmptyObject(o.UBICACION)||"0.0"==o.UBICACION.lat)&&(o.UBICACION.lat=41.441523,o.UBICACION.lng=2.203042,o.UBICACION.direccion="Carrer de Caracas 13, 08030, Barcelona"),"None"==o.UBICACION.direccion&&(o.UBICACION.lat=41.441523,o.UBICACION.lng=2.203042,o.UBICACION.direccion="Carrer de Caracas 13, 08030, Barcelona"),"0:00:00"!=o.PS_INFO.hora_finalizacion&&"None"!=o.PS_INFO.hora_finalizacion)c=7==o.UBICACION.IDEstado||8==o.UBICACION.IDEstado?7==o.UBICACION.IDEstado?moment(o.UBICACION.hora,"HH:mm").add("30","minutes").toDate():moment(o.UBICACION.hora,"HH:mm").add("60","minutes").toDate():moment(o.PS_INFO.hora_finalizacion,"HH:mm").toDate();else if("0:00:00"==o.PS_INFO.hora_llegada)c=new Date;else if(n=o.PS_INFO.hora_llegada,""==o.PS_INFO.tiempo_estimado_trabajo||"00:00:00"==o.PS_INFO.tiempo_estimado_trabajo)c=null;else{l=60*o.PS_INFO.tiempo_estimado_trabajo;var s=moment(new Date),d=60*s.hour()+s.minute();c=moment(n,"HH:mm").add(l,"minutes").toDate();var p=moment(c,"HH:mm"),u=60*p.hour()+p.minute(),m=u-d;m<0&&(c=moment(c).add(60,"minutes").toDate())}null!=c&&(direccionesEquipo.push(JSON.parse('{"latLng":['+o.UBICACION.lat+", "+o.UBICACION.lng+'], "address": "'+o.UBICACION.direccion_gps+'", "id":"'+o.id+'", "options": {"icon": "'+r+'"}}')),listEquipos.push(o)),o.PS_INFO.ps==a.id&&(PSAsignado=o.id)}}),e(listEquipos)}})}),direccionesEquipo.push(JSON.parse('{"latLng":['+a.lat+", "+a.lng+'], "address": "'+a.direccion+", "+a.cp+", "+a.poblacion+'", "options": {"icon": "'+a.marker+'"}}'))}function e(a){var e,o,i,t;$("#equiposList .collection").empty(),a.sort(compareTiempos);for(var n=0;n<a.length;n++)o="",t="",i="",e="0:00:00"==a[n].PS_INFO.hora_llegada&&"0:00:00"!=a[n].PS_INFO.hora_aviso?"(En desplazamiento)":"",$.isEmptyObject(a[n].SUBEQUIPO)||$.each(a[n].SUBEQUIPO,function(a,e){o+='<span class="new badge purple" data-badge-caption="'+e.nombre+'"></span>'}),$.isEmptyObject(a[n].PERSONAL)||$.each(a[n].PERSONAL,function(a,e){t+="- "+e.data.nombre+" "+e.data.apellido1+" "+e.data.apellido2+"<br />"}),a[n].PAUSA.Estado&&(i='<i class="material-icons small right">restaurant</i>'),0==a[n].CONTADOR_COLA||1==a[n].CONTADOR_COLA&&""!=a[n].PS_INFO.tiempo_estimado_trabajo?$("#equiposList .collection").append('<li class="collection-item avatar itemEquipo estadoEquipo'+a[n].UBICACION.idEstado+'" idEquipo="'+a[n].id+'"><i class="z-depth-2 material-icons circle orange tooltippedEquipo" data-tooltip="'+t+'">directions_car</i><span class="title">'+i+a[n].nombre+" "+e+"</span><p>"+a[n].UBICACION.direccion+"<br>Hora estimada de llegada a PS: "+a[n].horaEstimada+"<br />"+o+"</p></li>"):$("#equiposList .collection").append('<li class="collection-item avatar itemEquipo estadoEquipo'+a[n].UBICACION.idEstado+' estadoEquipoBloqueado" idEquipo="'+a[n].id+'"><i class="z-depth-2 material-icons circle orange tooltippedEquipo" data-tooltip="'+t+'">directions_car</i><span class="title">'+i+a[n].nombre+" "+e+"</span><p>"+a[n].UBICACION.direccion+"<br>Hora estimada de llegada a PS: "+a[n].horaEstimada+"<br />"+o+"</p></li>"),$(".tooltippedEquipo").tooltip({delay:50,position:"top",html:!0});S(direccionesEquipo),$("#loadingEquipos").hide(),$('li[idEquipo="'+PSAsignado+'"]').trigger("click")}function o(){$(".radioOrdenacion").append('<p><input name="ordenacion" type="radio" id="ordenacion_ps1" value="1" checked /><label for="ordenacion_ps1">Hora</label></p>'),$(".radioOrdenacion").append('<p><input name="ordenacion" type="radio" id="ordenacion_ps2" value="2" /><label for="ordenacion_ps2">ID PS</label></p>')}function i(){jQuery.getJSON(URLAPI+"/equipos/keyvalue/tipo_ps",function(a){var e=!0,o=window.location.href;-1==o.indexOf("?clean")&&(e=!1),$.each(a.contenido,function(a,o){listTiposPS.push(o),1!=o.id||e?$(".radioTipos").append('<p><input name="tipo_ps" type="radio" id="tipo_ps'+o.id+'" value="'+o.id+'"  /><label for="tipo_ps'+o.id+'">'+o.tipo+"</label></p>"):$(".radioTipos").append('<p><input name="tipo_ps" type="radio" id="tipo_ps'+o.id+'" value="'+o.id+'" checked /><label for="tipo_ps'+o.id+'">'+o.tipo+"</label></p>")})})}function t(){jQuery.getJSON(URLAPI+"/equipos/keyvalue/estado",function(a){var e=!0,o="",i=window.location.href;-1==i.indexOf("?clean")&&(e=!1),$.each(a.contenido,function(a,o){listEstados.push(o),8!=o.id||e?$(".radioEstados").append('<p><input name="estado" type="radio" id="estado'+o.id+'" value="'+o.id+'" /><label for="estado'+o.id+'">'+o.ESTADO+'</label><span class="badge bagde'+o.id+' badges"></span></p>'):$(".radioEstados").append('<p><input name="estado" type="radio" id="estado'+o.id+'" value="'+o.id+'" checked /><label for="estado'+o.id+'">'+o.ESTADO+'</label><span class="badge bagde'+o.id+' badges"></span></p>')}),e||(o="&tipo=1"),contadorPS(o),controlEquipos||(e?(loadPSList(),$(".collapsible").collapsible("close",0)):(loadPSList("fecha1="+fecha+"&estado=8&tipo=1&order=hora_programat-ASC"),aplicarFiltro()))})}function n(){jQuery.getJSON(URLAPI+"/equipos/keyvalue/naturaleza",function(a){$.each(a.contenido,function(a,e){listNaturalezas.push(e),$(".radioNaturaleza").append('<p><input name="naturaleza" type="radio" id="naturaleza'+e.id+'" value="'+e.id+'"  /><label for="naturaleza'+e.id+'">'+e.naturaleza+"</label></p>")})})}function l(){jQuery.getJSON(URLAPI+"/equipos/keyvalue/urgencia",function(a){$.each(a.contenido,function(a,e){listUrgencias.push(e),$(".radioUrgencia").append('<p><input name="urgencia" type="radio" id="urgencia'+e.id+'" value="'+e.id+'"  /><label for="urgencia'+e.id+'">'+e.urgencia+"</label></p>")})})}function c(a,e){var o={idPS:a,idEquipo:e,update_pack:attrAgrupada},i=URLAPI+"/equipos/cola_ps/equipo/"+e+"/ps/"+a+"?date="+datetime+"&update_pack="+attrAgrupada;$.post(i,o,function(a){200==a.codigo?Materialize.toast(a.detalles,4e3):100==a.codigo&&(s(e),Materialize.toast("Asignación realizada correctamente",4e3),$("#equiposListCol .itemEquipo").hide(),$('li[idEquipo="'+e+'"]').show(),$("#infoPSEquipo .asignaPS").hide(),$("#infoPSEquipo .cancelarPS").show(),$("#infoPSEquipo .cambioEquipoPS").show())},"json")}function r(a,e,o,i){var t={idPS:a,idEquipo:e,update_pack:o},n=URLAPI+"/equipos/cola_ps/cancelar/equipo/"+e+"/ps/"+a+"?update_pack="+o;$.post(n,t,function(a){200==a.codigo?Materialize.toast(a.detalles,4e3):100==a.codigo&&(i?Materialize.toast("Asignación de PS cancelada",2e3,"",function(){location.reload()}):Materialize.toast("Asignación de PS cancelada",2e3))},"json")}function s(a){var e={idEquipo:a},o=URLAPI+"/equipos/alerta/sin_servicio/eliminar/idEquipo/"+a;$.post(o,e,function(a){200==a.codigo?Materialize.toast(a.detalles,4e3):100==a.codigo&&avisoEquipoSinPS()},"json")}function d(a,e){$("#MessageConfirmation").html("PS "+a+' .PS generada Nº <a href="http://app.aqualyt.net/sf/action.php?SOURCE=PS2&ACTION=SHOWINITIAL&LOAD_PS='+e+'" target="_blank">'+e+"</a>"),$("#dialog-message").dialog({modal:!0,buttons:{Ok:function(){location.reload()}}})}function p(a,e,o){var i={idPS:a,motivo:e,next:o};$.post(URLAPI+"/equipos/ps/anular/"+a+"?motivo="+e+"&next="+o+"&update_pack=0",i,function(a){200==a.codigo?Materialize.toast(a.detalles,4e3):100==a.codigo&&(1==o?d("anulada",a.contenido.idGenerada):(Materialize.toast("PS anulada",4e3),history.go(0)))},"json")}function u(a,e,o){var i={idPS:a,motivo:e,next:o};$.post(URLAPI+"/equipos/ps/anular/"+a+"?motivo="+e+"&next="+o+"&update_pack=1",i,function(a){200==a.codigo?Materialize.toast(a.detalles,4e3):100==a.codigo&&(1==o?d("anulada",a.contenido.idGenerada):(Materialize.toast("PS anulada",4e3),history.go(0)))},"json")}function m(a,e,o){var i={idPS:a,motivo:e,next:o};$.post(URLAPI+"/equipos/ps/no_realizado/"+a+"?motivo="+e+"&next="+o+"&update_pack=0",i,function(a){200==a.codigo?Materialize.toast(a.detalles,4e3):100==a.codigo&&(1==o?d("no realizada",a.contenido.idGenerada):(Materialize.toast("PS no realizada",4e3),history.go(0)))},"json")}function g(a,e,o){var i={idPS:a,motivo:e,next:o};$.post(URLAPI+"/equipos/ps/no_realizado/"+a+"?motivo="+e+"&next="+o+"&update_pack=1",i,function(a){200==a.codigo?Materialize.toast(a.detalles,4e3):100==a.codigo&&(1==o?d("no realizada",a.contenido.idGenerada):(Materialize.toast("PS no realizada",4e3),history.go(0)))},"json")}function h(a){for(var e=0,o=listPS.length;e<o;e++)if(listPS[e].id==a)return listPS[e];return null}function S(a){var e=[];a.forEach(a=>{e.push({latLng:a.latLng,options:a.options,id:a.id})}),teamMapLoaded&&$("#map2").gmap3({clear:{name:["marker","directionsrenderer","trafficlayer"]}}),$("#map2").gmap3({map:{options:{center:[46.578498,2.457275],zoom:5}},marker:{values:e,options:{draggable:!1},events:{click:function(a,e,o){var i=o.id;$("li[idequipo='"+i+"']").click()}}},autofit:{}}),teamMapLoaded=!0}Token=Cookies.get("AquaToken"),$.ajaxSetup({cache:!1,headers:{token:Token,"Content-Type":"application/json"}}),jQuery.getJSON(URLAPI+"/equipos/get_rechazos?fecha1="+fecha,function(a){100==a.codigo&&(PSRechazadas=a.contenido.contador)}),jQuery.getJSON(URLAPI+"/equipos/alertas/count?idTipoAlerta=7&date="+fecha,function(a){100==a.codigo&&(EquiposSinPS=a.contenido.count),EquiposSinPS>0&&$(".controlEquiposMenu").append(' <span class="new badge red header" data-badge-caption="">'+EquiposSinPS+"</span>")}),$(".itemPSFilter").hide(),column_sizer(),$(window).resize(column_sizer),controlEquipos?loadEquiposListParrilla():(i(),o(),t(),n(),l(),countPSList(),loadEquiposList()),loadNotas(),$("#filtroFecha").html(fecha),$("#filtroFechaMobile").html(fecha),$("#SelectFiguraRechazado").material_select(),$("#modal1").modal(),$("#modalPS").modal(),$("#modalAsignar").modal({ready:function(a,e){$(".idPSAsignar").text(idPS),$(".idEquipoAsignar").text(nombreEquipo)}}),$("#modalCancelar").modal({ready:function(a,e){$(".idPSCancelar").text(idPS),$(".idEquipoCancelar").text(nombreEquipo)}}),$("#modalCambioEquipo").modal({ready:function(a,e){$(".idPSCambio").text(idPS),$(".idEquipoCambio").text(nombreEquipo),$("#idPSaCambiar").val(idPS)}}),$("#modalPausa").modal(),$("#modalAnular").modal(),$("#modalAnularPack").modal(),$("#modalNoRealizada").modal(),$("#modalNoRealizadaPack").modal(),$("#modalCambioFecha").modal(),$("#modalCambioFechaPack").modal(),$("#modalLeyenda").modal(),$(".modal").modal(),$("#anularPStext").trigger("autoresize"),$(".button-collapse").sideNav(),$(".datepicker").pickadate({weekdaysFull:["Domingo","Lunes","Martes","Miércoles","Jueves","Viernes","Sábado"],weekdaysShort:["Dom","Lun","Mar","Mié","Jue","Vie","Sab"],monthsFull:["Enero","Febrero","Marzo","Abril","Mayo","Junio","Julio","Agosto","Septiembre","Octubre","Noviembre","Diciembre"],monthsShort:["Ene","Feb","Mar","Abr","May","Jun","Jul","Ago","Sep","Oct","Nov","Dic"],firstDay:1,selectMonths:!0,selectYears:2,today:"Hoy",clear:"Limpiar",close:"Seleccionar",closeOnSelect:!1,labelMonthNext:"Mes siguiente",labelMonthPrev:"Mes anterior",labelMonthSelect:"Selecciona un mes del desplegable",labelYearSelect:"Selecciona un año del desplegable",container:"body",formatSubmit:"dd/mm/yyyy",onClose:function(){null!=datepicked&&"Invalid date"!=datepicked&&window.location.replace(window.location.pathname+"?fecha="+datepicked)},onSet:function(a){datepicked=moment(a.select,"x").format("DD[/]MM[/]YYYY")}}),$(".datepickerPausa").pickadate({weekdaysFull:["Domingo","Lunes","Martes","Miércoles","Jueves","Viernes","Sábado"],weekdaysShort:["Dom","Lun","Mar","Mié","Jue","Vie","Sab"],monthsFull:["Enero","Febrero","Marzo","Abril","Mayo","Junio","Julio","Agosto","Septiembre","Octubre","Noviembre","Diciembre"],monthsShort:["Ene","Feb","Mar","Abr","May","Jun","Jul","Ago","Sep","Oct","Nov","Dic"],firstDay:1,selectMonths:!0,selectYears:2,today:"Hoy",clear:"Limpiar",close:"Seleccionar",closeOnSelect:!1,labelMonthNext:"Mes siguiente",labelMonthPrev:"Mes anterior",labelMonthSelect:"Selecciona un mes del desplegable",labelYearSelect:"Selecciona un año del desplegable",container:"body",formatSubmit:"dd/mm/yyyy",onSet:function(a){datepickedPausa=moment(a.select,"x").format("DD[/]MM[/]YYYY")}}),$(".datepickerNuevaFecha").pickadate({weekdaysFull:["Domingo","Lunes","Martes","Miércoles","Jueves","Viernes","Sábado"],weekdaysShort:["Dom","Lun","Mar","Mié","Jue","Vie","Sab"],monthsFull:["Enero","Febrero","Marzo","Abril","Mayo","Junio","Julio","Agosto","Septiembre","Octubre","Noviembre","Diciembre"],monthsShort:["Ene","Feb","Mar","Abr","May","Jun","Jul","Ago","Sep","Oct","Nov","Dic"],firstDay:1,selectMonths:!0,selectYears:2,today:"Hoy",clear:"Limpiar",close:"Seleccionar",closeOnSelect:!1,labelMonthNext:"Mes siguiente",labelMonthPrev:"Mes anterior",labelMonthSelect:"Selecciona un mes del desplegable",labelYearSelect:"Selecciona un año del desplegable",container:"body",formatSubmit:"yyyy-mm-dd",hiddenSuffix:"_submit",hiddenName:"false",onSet:function(a){datepickedNueva=moment(a.select,"x").format("YYYY[-]MM[-]DD")}}),$(".timepicker").pickatime({default:"now",fromnow:0,twelvehour:!1,donetext:"OK",cleartext:"Limpiar",canceltext:"Cancelar",autoclose:!1,ampmclickable:!1,container:"body",aftershow:function(){}}),$(".timepickerNuevaHora").pickatime({default:"now",fromnow:0,twelvehour:!1,donetext:"OK",cleartext:"Limpiar",canceltext:"Cancelar",autoclose:!1,ampmclickable:!1,container:"body",aftershow:function(){}}),$("#buscador").on("input",function(a){var e=$("#buscador").val().toUpperCase();e.length>3?$("li.itemPS:not([searchTerms*='"+e+"'])").hide():$("li.itemPS").show()}),$("#buscadorPS").on("input",function(a){var e=$("#buscadorPS").val().toUpperCase();e.length>3?$("#PSListContactos a:not([idPS*='"+e+"'])").hide():$("#PSListContactos a").show()}),$(".itemPSList").on("click",".itemPSAll",function(a){a.preventDefault(),window.location.href=window.location.href.replace(/[\?#].*|$/,"?clean?fecha="+fecha)}),$(".itemPSList").on("dblclick",".itemPS",function(a){a.preventDefault(),a.stopPropagation(),$(".collapsibleModal").collapsible("close",0),$(".collapsibleModal").collapsible("close",1),$(".collapsibleModal").collapsible("close",2),$("#lugarLat").val("0"),$("#lugarLong").val("0"),$("#autocomplete").val(""),$("#IDLugar").val(""),idPS=$(this).attr("idps"),attrAgrupada=$(this).attr("agrupada"),0==attrAgrupada?$("#actionPack").hide():$("#actionPack").show();var e=h(idPS);$(".idPSAnular").html(idPS),$("#ModalPSTitle").html("<a href='http://app.aqualyt.net/sf/action.php?SOURCE=PS2&ACTION=SHOWINITIAL&LOAD_PS="+e.id+"' target='_blank'>PS: "+e.id+"</a>"),$("#ModalSolicitante").text(e.solicitant),$("#ModalDireccion").html(e.direccion+", "+e.cp+" "+e.poblacion),$("#ModalDireccionGPS").html(e.direccion_gps),$("#ModalAgente").text(e.agente_nombre),$("#ModalEstado").text(e.estado_string),$("#ModalNaturaleza").text(e.naturaleza_string),$("#ModalTipo").text(e.tipo_string),$("#ModalUrgencia").text(e.urgencia_string),$("#ModalProblema").text(e.problema),""!=e.equipo_pre?$(".equipoPre").text("("+e.equipo_pre+")"):$(".equipoPre").text(""),""!=e.notas?($("#collapsibleModalNotas").show(),$("#ModalNotas").text(e.notas),$("#switchNota").show()):($("#collapsibleModalNotas").hide(),$("#switchNota").hide()),""!=e.nota_vital?($("#collapsibleModalNotaVital").show(),$("#ModalNotaVital").text(e.nota_vital),$("#switchNotaVital").show()):($("#collapsibleModalNotaVital").hide(),$("#switchNotaVital").hide()),$("#idLugar").val(e.id_lugar_actuacion),$("#modalPS").modal("open"),""!=e.direccion_gps?createMapPSLocation(e.direccion_gps,idPS):createMapPSLocation(e.direccion,idPS)}),$(".itemPSList").on("click",".itemPS",function(e){if(e.preventDefault(),!$(this).hasClass("agrupada")){idEquipo=null,direccionesEquipo=[],$("#equiposListCol .itemEquipo").removeClass("itemPSSelected"),
$(".collection-item.itemPS").removeClass("itemPSSelected"),$("#anularPStext").val(""),$("#noRealizadaPStext").val(""),$(this).addClass("itemPSSelected"),idPS=$(this).attr("idPS"),attrAgrupada=$(this).attr("agrupada");var o=$(this).attr("estado"),i=$.grep(listPS,function(a){return a.id==idPS});3!=o&&7!=o?($("#mapaBig").hide(),$("#equiposList, #mapaSmall").fadeIn("slow"),$("#infoPSEquipo").hide(),$("#equiposList .collection").empty(),$("#loadingEquipos").show(),a(i[0])):($("#mapaBig").fadeIn("slow"),$("#equiposList, #mapaSmall").hide(),$("#infoPSEquipo").fadeIn("slow"))}}),$(".itemPSList").on("click",".expandButton",function(a){a.stopPropagation();for(var e=$(this).attr("idpspack"),o=e.split(","),i=0;i<o.length;i++)$("li[idPS='"+o[i]+"']").toggleClass("hide");$(this).find(".expandPack").toggleClass("hide"),$(this).find(".unexpandPack").toggleClass("hide")}),$("#equiposListCol").on("click",".itemEquipo",function(a){a.preventDefault(),$("#equiposListCol .itemEquipo").removeClass("itemPSSelected"),$(this).addClass("itemPSSelected"),$("#avisoPS").html(""),$("#llegadaPS").html(""),$("#tiempoTeorico").html(""),$("#finalizacionPS").html(""),idEquipo=$(this).attr("idEquipo");var e=$.grep(listEquipos,function(a){return a.id==idEquipo});nombreEquipo=e[0].nombre;var o=$.grep(listPS,function(a){return a.id==idPS}),i=!1;jQuery.getJSON(URLAPI+"/equipos/ps/"+idPS+"/estado",function(a){switch(createMapRutaEquipo(e[0].UBICACION.direccion_gps,o),$(".bloqueoText").hide(),0!=PSAsignado||"None"!=a.contenido[1].equipo_id_cola?$(".asignaPS").hide():0==e[0].CONTADOR_COLA||1==e[0].CONTADOR_COLA&&null!=e[0].PS_INFO.tiempo_estimado_trabajo?($(".asignaPS").show(),!0):($(".asignaPS").hide(),$(".bloqueoText").show()),e[0].idEstado){case 35:case 38:$(".asignaPS").hide();break;default:$(".cancelarPS").hide()}e[0].PS_INFO.ps==idPS&&"0:00:00"==e[0].PS_INFO.hora_llegada?($(".cancelarPS").show(),i=!0):$(".cancelarPS").hide(),a.contenido[1].equipo_id_cola==e[0].id&&"None"==a.contenido[1].equipo_id?($(".cancelarPSCola").show(),i=!0):$(".cancelarPSCola").hide(),i&&fecha==moment().format("DD[/]MM[/]YYYY")?$(".cambioEquipoPS").show():$(".cambioEquipoPS").hide(),$("#infoPSEquipo").fadeIn("slow"),$("#PSID").html(idPS),"0:00:00"!=e[0].PS_INFO.hora_aviso?$("#avisoPS").html("<br /> Aviso PS recibido: "+e[0].PS_INFO.hora_aviso):$("#avisoPS").html(""),"0:00:00"!=e[0].PS_INFO.hora_llegada?$("#llegadaPS").html("<br /> Hora llegada PS: "+e[0].PS_INFO.hora_llegada):$("#llegadaPS").html(""),""!=e[0].PS_INFO.tiempo_estimado_trabajo&&"00:00:00"!=e[0].PS_INFO.tiempo_estimado_trabajo?$("#tiempoTeorico").html("<br /> Tiempo teórico: "+60*e[0].PS_INFO.tiempo_estimado_trabajo+" minutos"):$("#tiempoTeorico").html(""),$("#direccion").html(o[0].direccion)})}),$("#modalAsignar").on("click","#asignarPSaEquipo",function(a){c(idPS,idEquipo)}),$("#modalCancelar").on("click","#desasignarPSaEquipo",function(a){r(idPS,idEquipo,attrAgrupada,!1)}),$(".desasignarColaPSEquipo").on("click",function(a){var e=$(this).attr("idPS"),o=$(this).attr("idEquipo"),i=$(this).attr("agrupada");r(e,o,i,!0)}),$(".cleanAlert").on("click",function(a){var e=$(this).attr("idAlerta"),o={idAlerta:e},i=URLAPI+"/equipos/alerta/eliminar/idAlerta/"+e;$.post(i,o,function(a){200==a.codigo?Materialize.toast(a.detalles,4e3):100==a.codigo&&Materialize.toast("Aviso de equipo sin PS eliminado",2e3,"",function(){location.reload()})},"json")}),$("#modalAnular").on("click","#anularPSConfirmar",function(a){var e=$("#anularPStext").val(),o=0;$("#siguientePS").is(":checked")&&(o=1),p(idPS,e,o)}),$("#modalAnularPack").on("click","#anularPSPackConfirmar",function(a){var e=$("#anularPSPacktext").val(),o=0;$("#siguientePSPack").is(":checked")&&(o=1),u(idPS,e,o)}),$("#modalNoRealizada").on("click","#noRealizadaPSConfirmar",function(a){var e=$("#noRealizadaPStext").val(),o=0;$("#siguientePSNoRealizada").is(":checked")&&(o=1),m(idPS,e,o)}),$("#modalNoRealizadaPack").on("click","#noRealizadaPSPackConfirmar",function(a){var e=$("#noRealizadaPSPacktext").val(),o=0;$("#siguientePSPackNoRealizada").is(":checked")&&(o=1),g(idPS,e,o)}),$("#modalCambioFecha").on("click","#modificarFecha",function(a){var e=[];e.push("update_pack=0"),null!=datepickedNueva&&e.push("dia="+datepickedNueva);var o=$("#nuevaHoraPS").val();null!=o&&""!=o&&e.push("hora="+o);var i=URLAPI+"/equipos/ps/"+idPS+"/programacion/cambiar?"+e.join("&");$.ajax({url:i,type:"PUT",data:e.join("&"),success:function(a){if(100==a.codigo){var e=$("<span>Fecha de la PS cambiada correctamente</span>").add($('<a class="btn-flat toast-action" href="index.php?fecha='+fecha+'">Recargar</a>'));Materialize.toast(e,5e3),datepickedNueva=null,o=null,$("#nuevaHoraPS").val("")}}})}),$("#modalCambioFechaPack").on("click","#modificarFechaPack",function(a){var e=[];e.push("update_pack=1"),null!=datepickedNueva&&e.push("dia="+datepickedNueva);var o=$("#nuevaHoraPS").val();null!=o&&""!=o&&e.push("hora="+o),$.ajax({url:URLAPI+"/equipos/ps/"+idPS+"/programacion/cambiar?"+e.join("&"),type:"PUT",data:e.join("&"),success:function(a){if(100==a.codigo){var e=$("<span>Fecha de la PS cambiada correctamente</span>").add($('<a class="btn-flat toast-action" href="index.php?fecha='+fecha+'">Recargar</a>'));Materialize.toast(e,5e3),datepickedNueva=null,o=null,$("#nuevaHoraPS").val("")}}})}),$("#actualizarDireccion").on("click",function(a){var e,o,i,t;a.preventDefault(),e=$("#lugarLat").val(),o=$("#lugarLong").val(),i=$("#idLugar").val(),t=$("#autocomplete").val(),$("#ModalDireccionGPS").removeClass("direccion"),$("#ModalDireccion").removeClass("direccion"),$.ajax({url:URLAPI+"/equipos/lugar_actuacion/geolocalizacion?id_lugar="+i+"&latitud="+e+"&longitud="+o,type:"PUT",data:"id_lugar="+i+"&latitud="+e+"&longitud="+o,success:function(a){$.ajax({url:URLAPI+"/equipos/lugar_actuacion/modificar_direccion?tipo_id=lugar&id="+i+"&direccion="+t,type:"PUT",data:"tipo_id=lugar&id="+i+"&direccion="+t,success:function(a){if(100==a.codigo){$("#ModalDireccionGPS").html(t),$("#ModalDireccionGPS").addClass("direccion"),$("#ModalDireccion").addClass("direccion");var e=$("<span>Dirección actualizada correctamente</span>").add($('<a class="btn-flat toast-action" href="index.php?fecha='+fecha+'">Recargar</a>'));Materialize.toast(e,5e3)}}})}})})});var autocomplete,psLocationMapLoaded=!1;$("#filtrarBtn").on("click",function(a){a.preventDefault(),aplicarFiltro(),$("#PSList").data("optiscroll").destroy()}),$("#pausarBtn").on("click",function(a){a.preventDefault();var e=$("#timePickerPausa").val(),o=moment(datepickedPausa+" "+e,"DD[/]MM[/]YYYY HH:mm").format("YYYY-MM-DD HH:mm:ss");if(""!=e&&""!=datepickedPausa){var i=$("input[name=tipoComida]:checked","#pausaForm").val(),t=$("#equiposSelect").val();$.post(URLAPI+"/equipos/equipo/pausa/"+i+"/equipo/"+t+"?lng=2.203042&lat=41.441523&direccion_gps=Carrer de Caracas, 13, 08030 Barcelona, España&date="+o,"",function(a){100==a.codigo?(Materialize.toast("Pausa asignada correctamente",4e3),$("#timePickerPausa").val(""),$("#equiposSelect").val("")):(Materialize.toast("ha habido un problema asignando la pausa",4e3),$("#timePickerPausa").val(""),$("#equiposSelect").val(""))},"json")}else alert("Se ha de introducir la fecha y hora de inicio de pausa")}),$("#cambiarEquipoPS").on("click",function(a){a.preventDefault();var e=$("#idPSaCambiar").val(),o=$("#equiposSelectCambio").val();if(""!=o){var i=URLAPI+"/equipos/ps/"+e+"/cambiar_equipo/"+o+"?update_pack="+attrAgrupada;$.ajax({url:i,type:"PUT",data:"",success:function(a){if(100==a.codigo){var e=$("<span>Equipo asignado cambiado correctamente</span>").add($('<a class="btn-flat toast-action" href="index.php?fecha='+fecha+'">Recargar</a>'));Materialize.toast(e,5e3),$("#equiposSelectCambio").val(""),$("#idPSaCambiar").val("")}else alert(a.detalles)}})}else alert("Se ha de seleccionar un equipo")}),$("#enviarNotas").on("click",function(){var a=$("#textoNotas").val(),e={nota:a};$.post(URLAPI+"/equipos/parrilla/notas/set?notas="+a,e,function(a){200==a.codigo?Materialize.toast(a.detalles,4e3):100==a.codigo&&(Materialize.toast("Nota añadida correctamente",4e3,"",function(){window.location.reload()}),$("#modal1").modal("close"),$("#textoNotas").val(""))},"json")}),controlEquipos||setInterval(function(){avisoNuevaPS(),avisoRechazosPS(),avisoEquipoSinPS()},6e3);